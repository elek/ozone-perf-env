source:
  - url: git::https://github.com/flokkr/docker-hadoop.git
  - url: git::https://github.com/flokkr/docker-ozone.git
  - url: git::https://github.com/elek/docker-byteman.git
  - path: ../flekszible
import:
  - path: ozone
    transformations:
    - type: image
      image: elek/ozone-dev
    - type: add
      trigger:
         metadata:
            name: ozone-config
      path:
        - data
      value:
         LOG4J.PROPERTIES_log4j.logger.org.apache.hadoop.hdfs.protocol.datatransfer.sasl: ERROR
  - path: hdfs
    transformations:
    - type: add
      trigger:
         metadata:
            name: hdfs-config
      path:
        - data
      value:
         CORE-SITE.XML_fs.defaultFS: hdfs://hdfs-namenode-0.hdfs-namenode:9820/
transformations:
  - type: byteman/install
  - type: add
    path:
    - spec
    - template
    - spec
    - containers
    - .*
    - volumeMounts
    value:
      - name: btm
        mountPath: /opt/btm
  - type: add
    path:
    - spec
    - template
    - spec
    - volumes
    value:
      - name: btm
        configMap:
             name: btm
             defaultMode: 0755
  - type: add
    path:
    - spec
    - template
    - spec
    - containers
    - .*
    - env
    value:
       - name: HADOOP_OPTS
         value: -javaagent:/opt/byteman/lib/byteman.jar=script:/opt/btm/hcfs-write.btm
