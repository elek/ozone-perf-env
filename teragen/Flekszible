source:
  - url: git::https://github.com/flokkr/k8s.git
  - url: git::https://github.com/flokkr/infra-flekszible.git
  - url: git::https://github.com/elek/ozone-flekszible.git
  - path: ../flekszible
import:
  - path: util
  - path: hadoop
  - path: spark
    destination: spark
    transformations:
    - type: image
      image: flokkr/spark:2.4.4
    - type: hadoop/distribute
      image: flokkr/hadoop
    - type: ozone/client-config
    - type: ozone/ozonefs
      image: elek/ozone:0.5.0-rc2-beta
    - type: yarn/config
    - type: hdfs/config
  - path: mapreduce
    destination: mr
    transformations:
    - type: ozone/ozonefs
      image: elek/ozone:0.5.0-rc2-beta
    - type: perftest/runconfigmap
      configmap:  teragen-testscript
      scriptname: teragen.sh
  - path: yarn
    destination: yarn
    transformations:
    - type: ozone/ozonefs
      image: elek/ozone:0.5.0-rc2-beta
    - type: PublishService
    - type: add
      path:
       - spec
       - template
       - spec
      value:
         nodeSelector:
            partition: upper
  - path: ozone
    destination: ozone
    transformations:
    - type: perftest/jvm
    - type: perftest/tuning
#    - type: add
#      trigger:
#         metadata:
#            name: ozone-config
#      path:
#        - data
#      value:
#        OZONE-SITE.XML_ozone.scm.chunk.layout: FILE_PER_CHUNK
    - type: remove
      path:
        - data
        - CORE-SITE.XML_fs.defaultFS
    - type: image
      image: elek/ozone:0.5.0-rc2-beta
    - type: ozone/pvstorage
    - type: add
      path:
        - spec
        - template
        - spec
      value:
        nodeSelector:
           partition: lower
  - path: hdfs
    destination: hdfs
    transformations:
    - type: perftest/pvdata
    - type: add
      path:
        - spec
        - template
        - spec
      value:
        nodeSelector:
           partition: lower
